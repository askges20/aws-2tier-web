## 6. DB 모니터링 대시보드
### 1) Cloudwatch란?

- AWS의 모든 서비스를 모니터링하는 기본 서비스
- RDS 모니터링 대시보드를 만들어볼 것

### 2) RDS에서 Cloudwatch에 접근하는 방법

#### 1. RDS 서비스의 모니터링 메뉴로 접속

- RDS - 데이터베이스 클릭
- 모니터링 메뉴에서 나오는 그래프가 Cloudwatch에서 가져온 것
- 한계 : RDS 에러로그 파일을 확인할 수 없음
- 자세한 모니터링을 위해 RDS에서 로그 파일을 Cloudwatch로 보내야함
- RDS 선택 후 `수정` 클릭 - `로그 내보내기` 항목
    - 일반 로그 : DB의 모든 로그를 남기는 로그, DB 부하를 주기 때문에 보통 사용 X
    - 느린쿼리 로그 : 쿼리가 느릴 때 남기는 로그
    - 에러 로그 : 에러를 남기는 로그

    ➡ 에러 로그, 느린쿼리 로그 선택
- 계속 - `즉시 적용` 버튼 클릭해서 적용 완료

#### 2. Cloudwatch에 직접 접근

- 에러 로그, 느린쿼리 로그 확인 가능
- AWS에서 Cloudwatch 서비스로 접속
- `로그 그룹` 가보면 기본으로 error 로그 하나만 존재함

### 3) 대시보드 이용하기

- 원하는 로그를 그래프로 모아서 볼 수 있음
- Cloudwatch의 대시보드 - `대시보드 생성` 버튼
- 대시보드 이름 입력 후 위젯 유형 선택 (행 - 시간별 지표 비교, 지표 기반으로 함)

#### RDS 에러 로그 그래프

- 지표에 RDS, DB 이름을 키워드로 두고 검색
- RDS에서 보내준 로그 지표와 RDS를 만들면 자동으로 구성되는 데이터베이스 지표가 있음
- 보내준 로그 지표에서 IncomingLogEvent 에러 로그 선택 ➡ 그래프 생성 완료

#### RDS CPU 사용량 그래프

- 지표에 RDS, CPU를 키워드로 ➡ 데이터베이스별 지표 선택
- CPU Utilization 선택
- CPU 관련 지표 설명
    - `FreeableMemory` : 사용가능한 메모리
    - `Read IOPS` : 초당 읽고 있는 숫자
    - `Write IOPS` : 초당 쓰고 읽는 숫자
    - `Latency` : 지연시간

#### 인사이트

- 위젯 추가 ➡ 로그 테이블 선택
- 로그를 쿼리해서 해당 로그를 보여주는 기능
- 로그 그룹 선택 (에러 로그 그룹 선택)
- 오른쪽에 있는 폴더에서 쿼리 샘플 확인 가능
- 다음과 같이 쿼리 입력 후 `쿼리 실행` 클릭

```sql
fields @timestamp, @message
| sort @timestamp desc
| parse 'warning' as query
| sort @timestamp desc
/*fields는 출력할 항목, sort는 정렬, parse는 조건절*/
```

- DB에 에러가 한번도 없는 상태에서는 아무것도 안나옴
- parse에 warning 조건을 주었기 때문에 warning이 포함된 결과만 나오게됨
- `위젯 생성`을 눌러서 warning만 출력되는 로그 위젯을 생성할 수 있음

`💡 반드시 대시보드 저장!!`
